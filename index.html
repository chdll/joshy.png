<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Hello World!</title>

  </head>
  <body>
    <!-- <p id="timeDisplay">Last Mouse Move Time: <span id="timeValue"></span></p> -->
    <video src="https://cdn.zilpe.co.uk/plssub.mp4" autoplay loop muted></video>

    <!-- <button type = "button" id = "fadeout">fade out</button> -->

    <script type="module" src="/src/renderer.js"></script>
    <script scr="https://docs.opencv.org/4.10.0/opencv.js"></script>
    <p id = "clock"></p>
    <script>
    //window.electronAPI.fadeout()
    var distracted = false;
    var timeDifference = 0
      // Updates lastMouseMoveTime when the mouse is moved
    var lastInputTime = new Date();
    var keyboardMouseInput = function () {
      lastInputTime = new Date();
    }
    document.addEventListener('mousemove', keyboardMouseInput, false);
    document.addEventListener('keydown', keyboardMouseInput, false);
    document.addEventListener('keyup', keyboardMouseInput, false);

    // Check time difference every second
    
    setInterval(() => {
      const currentTime = new Date();
      timeDifference = (currentTime - lastInputTime) / 1000; // Convert to seconds
      

      if(timeDifference > 20.0 && distracted == false) {
        distractedUser(); // Call the function if more than 20 seconds elapse between inputs
        distracted = true;
      }
      else if(timeDifference <= 20 && distracted){
        if(distracted){
          startpomo();
          window.electronAPI.fadeout()
          distracted = false
        }
        console.log(timeDifference.toString())
      };
    }, 1000);

    //placeholder for function when they are distracted
    function distractedUser(){
      console.log("User is distracted")
      pausepomo();
      window.electronAPI.fadein()
    }

    // Time at start of program
    // probably change to be initialised when user presses start
    const startTime = new Date();
    let pomotimer;
    secselapsed = 0;
    console.log("25 minute")
    function startpomo(){
      pomotimer = setInterval(()=>{
        secselapsed += 1;
        minsleft = Math.floor((1800 - secselapsed) / 60);
        secsleft = (1800 - secselapsed) % 60
        console.log("time remaining: "  + minsleft.toString() + ":" + secsleft.toString())
        if(secselapsed == 1500){
          console.log("5 minute break");
        }
        if(secselapsed == 1800){
          console.log("25 minute");
          secselapsed = 0;
        }
      },1000)
    }
    startpomo();
    function pausepomo(){
      clearInterval(pomotimer);
      console.log("paused")
    }
    </script>
  </body>
</html>